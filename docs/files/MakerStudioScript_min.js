"use strict";(()=>{const t="UserCurrentMode",e="CachedSong",a="AutoSaveEnabled",o="AutoSaveInterval",r="FontType",n="DarkModeMakerStudio",s="SelectionMode",l="EditingMode",i=5,c=jQuery("#selectionMode"),u=jQuery("#editMode"),d=jQuery("#newFile"),g=jQuery("#getFile"),m=jQuery("#fontIncreaseButton"),b=jQuery("#fontDecreaseButton"),f=jQuery("#toggleDark"),y=jQuery("#changeFont"),p=jQuery("#resumeFile"),S=jQuery("#returnSelectMode"),h=jQuery("#songDataTable"),k=jQuery("#attr_songName"),x=jQuery("#attr_songSize"),I=jQuery("#attr_songAuthor"),D=jQuery("#attr_toneLength"),v=jQuery("#attr_toneDelay"),j=jQuery("#attr_creationDate"),C=jQuery("#attr_lastEditDate"),N=jQuery("#autoSaveMessage"),w=jQuery("#autoSaveMessageText"),E=jQuery("#autoSaveEnabled"),M=jQuery("#autoSaveInterval"),Q=jQuery("#autoSaveSettingsSaveLink"),T=jQuery("#playingLabel"),P=jQuery("#songProgressBar"),F=jQuery("#currentProgressTime"),A=jQuery("#endingTime"),z=jQuery("#skipBack"),O=jQuery("#skipForward"),Y=jQuery("#playPauseSong"),L=jQuery("#restartSong"),B=jQuery("#stopSong"),G=jQuery("#songVolume"),R=jQuery("#downloadBtn"),U=jQuery("#copyBtn"),H=jQuery("#restartBtn"),_=["10px","12px","16px","20px","24px"],V=!0,X=500;let q=!1,J=!1,W=0,K=0,Z=0,tt=2,et=!1;const at=Object.freeze(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_"]),ot=Object.freeze({END:0,PS:1,B0:31,C1:33,CS1:35,D1:37,DS1:39,E1:41,F1:44,FS1:46,G1:49,GS1:52,A1:55,AS1:58,B1:62,C2:65,CS2:69,D2:73,DS2:78,FS2:93,G2:98,GS2:104,A2:110,AS2:117,B2:123,C3:131,CS3:139,D3:147,DS3:156,E3:165,F3:175,FS3:185,G3:196,GS3:208,A3:220,AS3:223,B3:247,C4:262,CS4:277,D4:294,DS4:311,E4:330,F4:349,FS4:370,G4:392,GS4:415,A4:440,AS4:466,B4:494,C5:523,CS5:554,D5:587,DS5:622,E5:659,F5:698,FS5:740,G5:784,GS5:831,A5:880,AS5:932,B5:988,C6:1047,CS6:1109,D6:1175,DS6:1245,E6:1319,F6:1397,FS6:1480,G6:1568,GS6:1661,A6:1760,AS6:1865,B6:1976,C7:2093,CS7:2217,D7:2349,DS7:2489,E7:2637,F7:2794,FS7:2960,G7:3136,GS7:3322,A7:3520,AS7:3729,B7:3951,getPitch:t=>Object.keys(ot).find(e=>ot[e]===t)});let rt={fileName:"EMPTY",size:0,attributes:{toneLength:50,toneDelay:80,author:"EMPTY",creationDate:"EMPTY",lastEdit:"EMPTY"},data:{src:[ot.B0,ot.END]}};function nt(t){V&&console.log(`[${gt()}] DEBUG: ${t}`)}function st(){switch(nt("Handling refresh()"),c.css({display:"none"}),u.css({display:"none"}),"true"===localStorage.getItem(a)?mt(localStorage.getItem(o))||(localStorage.setItem(o,i),nt("Use has auto save enabled but an invalid interval. Set to default.")):null===localStorage.getItem(a)&&(nt("Null value found for autosave, setting defaults"),localStorage.setItem(a,!0),localStorage.setItem(o,i)),mt(localStorage.getItem(o))?M.text(localStorage.getItem(o)):(localStorage.setItem(o,i),M.text(localStorage.getItem(o))),"true"===localStorage.getItem(a)?E.prop("checked",!0):E.prop("checked",!1),"true"===localStorage.getItem(n)?et=!0:"false"===localStorage.getItem(n)?et=!1:(localStorage.setItem(n,!1),et=!1),dt(),null===localStorage.getItem(r)&&localStorage.setItem(r,0),Number(localStorage.getItem(r))){case 1:$("body").css("font-family","Trebuchet MS");break;case 2:$("body").css("font-family","Times New Roman");break;case 3:$("body").css("font-family","Arial");break;case 4:$("body").css("font-family","Verdana");break;case 5:$("body").css("font-family","Segoe UI")}$(y).text("Change Font (Current: "+$("body").css("font-family")+")"),sessionStorage.getItem(t)===s?(c.css({display:"block"}),""===localStorage.getItem(e)&&(nt("Could not find song object."),p.css("display","none"))):sessionStorage.getItem(t)===l?(u.css({display:"block"}),""!==localStorage.getItem(e)&&"async-file"!==localStorage.getItem(e)&&(nt("Found song in localStorage, parsing..."),rt=JSON.parse(atob(localStorage.getItem(e)))),k.text(rt.fileName),x.text(rt.size),I.text(rt.attributes.author),D.text(rt.attributes.toneLength),v.text(rt.attributes.toneDelay),j.text(rt.attributes.creationDate),C.text(rt.attributes.lastEdit),function t(){h.empty();h.append("<tr> <th>#</th> <th>Pitch</th> <th>Frequency (Hz)</th> <th>Action</th> </tr>");for(let t=0;t<rt.data.src.length;t++)t!==rt.data.src.length-1?h.append(ut(t+1,ct(t+1,ot.getPitch(rt.data.src[t])),rt.data.src[t])):h.append(ut(t+1,`<span style='font-weight: bold; color: red;'>${ot.getPitch(rt.data.src[t])}</span>`,rt.data.src[t]));rt.size=rt.data.src.length-1;x.text(rt.size);C.text(rt.attributes.lastEdit);$("button").click(e=>{let a;if(void 0!==(a=$(e.target).is("i")?$(e.target).parent().data("command"):$(e.target).data("command")))if("add"===a.split(",")[0]){let e=Number(a.split(",")[1]);rt.data.src.insert(e,ot.PS),it(),t()}else if("rem"===a.split(",")[0]){let e=Number(a.split(",")[1]);if(1===rt.size)return void alert("You cannot remove your last note!\nEither edit this note or add more!");rt.data.src.splice(e-1,1),it(),t()}else nt("ERROR: Found data-command tag but not a proper command.")});$("select").change(e=>{"edit"===$(e.target).data("command").split(",")[0]&&(rt.data.src[Number($(e.target).data("command").split(",")[1])-1]=Object.values(ot)[Object.keys(ot).indexOf($(e.target).val())],it(),t())});h.css("font-size",_[tt]);$("select").css("font-size",_[tt]);dt();nt("Finished updating table")}()):(sessionStorage.setItem(t,s),st()),$(y).text("Change Font (Current: "+$("body").css("font-family")+")")}function lt(){sessionStorage.getItem(t)===l&&(rt.fileName=k.text().toUpperCase(),rt.size=rt.data.src.length-1,rt.attributes.author=I.text(),rt.attributes.toneLength=Number(D.text()),rt.attributes.toneDelay=Number(v.text()),localStorage.setItem(e,btoa(JSON.stringify(rt))),nt("Song object was saved to localStorage."))}function it(){rt.attributes.lastEdit=gt()}function ct(t,e){let a='<select data-command="edit,'+t+'" title="Select Pitch">';for(let t=1;t<Object.keys(ot).length-1;t++)Object.keys(ot)[t]!==e?a+='<option value="'+Object.keys(ot)[t]+'">'+Object.keys(ot)[t]+"</option>":a+='<option value="'+Object.keys(ot)[t]+'" selected>'+Object.keys(ot)[t]+"</option>";return a+="</select>"}function ut(t,e,a){let o='<tr> <td style="padding: 8px;"><strong>{{INDEX}}</strong></td> <td>{{PITCH}}</td> <td>{{FREQUENCY}}</td> <td> <table border="0" cellspacing="0" cellpadding="2"> <tr> <td> <button aria-label="add" data-command="add,{{INDEX}}" style="padding: 5px; margin: 0; background: none;"> <i class="fas fa-plus-circle fa-lg" style="color: green;"></i> </button> </td> <td> <button aria-label="rem" data-command="rem,{{INDEX}}" style="padding: 5px; margin: 0; background: none;"> <i class="fas fa-trash-alt fa-lg" style="color: red;"></i> </button> </td> </tr> </table> </td> </tr>';return a===ot.END&&(o='<tr> <td style="padding: 8px;"><strong>{{INDEX}}</strong></td> <td>{{PITCH}}</td> <td>{{FREQUENCY}}</td> <td> <table border="0" cellspacing="0" cellpadding="2"> <tr> <td> <button aria-label="add" style="padding: 5px; margin: 0; background: none;" disabled> <i class="fas fa-plus-circle fa-lg" style="color: green;"></i> </button> </td> <td> <button aria-label="rem" style="padding: 5px; margin: 0; background: none;" disabled> <i class="fas fa-trash-alt fa-lg" style="color: red;"></i> </button> </td> </tr> </table> </td> </tr>'),o=(o=(o=o.split("{{INDEX}}").join(String(t))).split("{{PITCH}}").join(String(e))).split("{{FREQUENCY}}").join(String(a))}function dt(){et?(f.text("Toggle Dark Mode (Dark Mode: On)"),$("body").css("background-color","#212226"),$("body").css("color","white"),$("span").css("border-color","white"),$("button").css("background-color","#3b4254")):(f.text("Toggle Dark Mode (Dark Mode: Off)"),$("body").css("background-color","unset"),$("body").css("color","unset"),$("span").css("border-color","unset"),$("button").css("background-color","unset"))}function gt(){const t=new Date;let e="";return t.getMonth()+1<10?(e+="0",e+=t.getMonth()+1):e+=t.getMonth()+1,e+="/",t.getDate()<10?(e+="0",e+=t.getDate()):e+=t.getDate(),e+="/",e+=t.getFullYear(),e+=" - ",t.getHours()>12?e+=t.getHours()-12:e+=t.getHours(),e+=":",t.getMinutes()<10?(e+="0",e+=t.getMinutes()):e+=t.getMinutes(),e+=" ",t.getHours()<=12?e+="AM":e+="PM",e}function mt(t){var e=Math.floor(Number(t));return e!==1/0&&String(e)===t&&e>=0}Array.prototype.insert=function(t,e){this.splice(t,0,e)};const bt=new(window.AudioContext||window.webkitAudioContext||window.audioContext);function ft(){let t="";t+=`# Welcome to a song file!\n# This song was created using MakerStudio2560, a custom song creation and playback tool made for the TuneStudio2560! (https://devjluvisi.github.io/TuneStudio2560/MakerStudio2560)\n\n# Song Author: ${rt.attributes.author}\n# Creation Date: ${rt.attributes.creationDate}\n# Last Edited: ${rt.attributes.lastEdit}\n\n# To view more information, check out https://github.com/devjluvisi/TuneStudio2560/wiki/For-Users\n\n# The delay between each different tone (ms). (Must be 9999 or less and greater than 0)\nTONE_DELAY=${rt.attributes.toneDelay}\n\n# The length that each tone should play for (ms). (Must be 255 or less and greater than 0)\nTONE_LENGTH=${rt.attributes.toneLength}\n\nData:\n`;for(let e=0;e<rt.size;e++)t+="  - "+ot.getPitch(rt.data.src[e])+"\n";return t+="\n",t+="# END"}function yt(){let t=0;for(let e=0;e<W;e++)rt.data.src[e]==ot.PS?t+=rt.attributes.toneDelay+rt.attributes.toneLength+X:t+=rt.attributes.toneDelay+rt.attributes.toneLength;return Math.trunc((t+(rt.attributes.toneDelay+rt.attributes.toneLength))/1e3)}function pt(){let t,e,a;return t=function(t,e){var a,o=[];for(a=0;a<t.length;a++)t[a]===e&&o.push(a);return o}(rt.data.src,1).length*X,e=rt.attributes.toneDelay*rt.size,a=rt.attributes.toneLength*rt.size,Math.trunc((t+e+a+(rt.attributes.toneDelay+rt.attributes.toneLength))/1e3)}p.click(()=>{nt("Attempting to resume edit"),sessionStorage.setItem(t,l),st()}),d.click(()=>{nt("Deleted data from localStorage"),sessionStorage.setItem(t,l),localStorage.setItem(e,""),st()}),g.change(e=>{nt("Reading from selected file..."),sessionStorage.setItem(t,l),function(t,e){let a=t.target.files[0],o=new FileReader;o.onload=e,o.readAsText(a)}(e,function(t){k.text(e.target.files[0].name),lt(),alert('File has been parsed.\nClick on "Resume File" to edit.')})}),S.click(()=>(location.reload(),sessionStorage.setItem(t,s),void st())),v.keypress(t=>{4!==v.text().length&&mt(String.fromCharCode(t.which))||(t.preventDefault(),t.stopImmediatePropagation())}),D.keypress(t=>{if(3===D.text().length||!mt(String.fromCharCode(t.which)))return t.preventDefault(),void t.stopImmediatePropagation()}),D.keyup(()=>{Number(D.text())>255&&D.text("255")}),I.keypress(t=>{15===I.text().length&&(t.preventDefault(),t.stopImmediatePropagation())}),k.keypress(t=>{8!==k.text().length&&function(t){return!!at.includes(String.fromCharCode(t).toUpperCase())}(t.which)||(t.preventDefault(),t.stopImmediatePropagation())}),M.keypress(t=>{3===M.text().length&&(t.preventDefault(),t.stopImmediatePropagation())}),N.mouseenter(()=>{"true"===localStorage.getItem(a)?w.text("Your progress is automatically saved in your browser when you exit. (Click to Configure)"):w.text("Your progress will not save (auto save disabled). (Click to Configure)")}),N.mouseleave(()=>{"true"===localStorage.getItem(a)?w.text("Your progress is automatically saved in your browser when you exit."):w.text("Your progress will not save (auto save disabled).")}),Q.click(()=>{mt(M.text())&&Number(M.text())>0?(localStorage.setItem(o,M.text()),localStorage.setItem(a,E.prop("checked")),alert("Your auto save settings have been saved."),lt(),location.reload()):alert("Invalid settings for autosave.\nPlease use numbers between 1 and 999.")}),Y.click(()=>{W!==rt.size&&(q?J?(T.text("Now Playing: "+rt.fileName),Y.attr("class","fas fa-pause-circle fa-lg"),J=!1):(T.text("Now Paused: "+rt.fileName),Y.attr("class","fas fa-play-circle fa-lg"),J=!0):(q=!0,J=!1,Y.attr("class","fas fa-pause-circle fa-lg"),T.text("Now Playing: "+rt.fileName)))}),L.click(()=>{Z=0,W=0,J=!1,q=!0,T.text("Now Playing: "+rt.fileName),Y.attr("class","fas fa-pause-circle fa-lg")}),B.click(()=>{Z=0,W=0,q=!1,J=!1,Y.attr("class","fas fa-play-circle fa-lg"),T.text("Press Play to Start Song")}),O.click(()=>{q&&(W+=Math.trunc(.1*rt.size<1?1:.1*rt.size))<0&&(W=0)}),z.click(()=>{q&&(W-=Math.trunc(.1*rt.size<1?1:.1*rt.size))<0&&(W=0)}),H.click(()=>{"Y"===prompt("Enter 'Y' if you are sure you want to delete all saved data.")&&(rt=null,localStorage.setItem(e,""),location.reload())}),R.click(()=>(function(t,e){const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)})(rt.fileName,ft())),U.click(()=>{navigator.clipboard.writeText(ft()).then(()=>{alert("Text for Song Copied.\nPaste using CTRL+V")}).catch(()=>{alert("There was a problem. Could not copy to clipboard.")})}),m.click(()=>{tt!==_.length-1&&(tt++,h.css("font-size",_[tt]),$("select").css("font-size",_[tt]))}),b.click(()=>{0!==tt&&(tt--,h.css("font-size",_[tt]),$("select").css("font-size",_[tt]))}),f.click(()=>{et?(et=!1,localStorage.setItem(n,!1)):(et=!0,localStorage.setItem(n,!0)),dt()}),y.click(()=>{let t=prompt("Select a font by typing in a number.\nThe font you select will be saved when you exit.\n(1) Trebuchet MS (Default)\n(2) Times New Roman\n(3) Arial\n(4) Verdana\n(5) Segoe UI");if(mt(t)&&Number(t)>0&&Number(t)<=5){switch(Number(t)){case 1:$("body").css("font-family","Trebuchet MS");break;case 2:$("body").css("font-family","Times New Roman");break;case 3:$("body").css("font-family","Arial");break;case 4:$("body").css("font-family","Verdana");break;case 5:$("body").css("font-family","Segoe UI")}localStorage.setItem(r,Number(t)),$(y).text("Change Font (Current: "+$("body").css("font-family")+")")}else alert("Invalid Input.\nPlease try again.")}),$(document).ready(()=>{st(),"EMPTY"===rt.attributes.creationDate&&(rt.attributes.creationDate=gt()),"true"===localStorage.getItem(a)?(setInterval(()=>{lt()},1e3*Number(localStorage.getItem(o))),nt("Enabled auto save. Set interval to "+1e3*Number(localStorage.getItem(o)))):w.text("Your progress will not save (auto save disabled)."),setInterval(()=>{if(!(W>=rt.size||!q||J)&&(K>0&&(K-=5),K<=0&&(K=0),K<=0)){rt.data.src[W]!=ot.PS?function(t,e,a,o,r){const n=bt.createOscillator(),s=bt.createGain();n.connect(s),s.connect(bt.destination),a&&(s.gain.value=a),e&&(n.frequency.value=e),o&&(n.type=o),r&&(n.onended=r),n.start(bt.currentTime),n.stop(bt.currentTime+(t||500)/1e3)}(rt.attributes.toneLength,rt.data.src[W],G.val()/100,"square"):K+=X,K+=rt.attributes.toneDelay+rt.attributes.toneLength,Z+=K,W++;let t=yt(),e=Math.trunc(t/60);(t-=60*e)<10?F.text(e+":0"+t):F.text(e+":"+t);let a=pt(),o=Math.trunc(a/60);(a-=60*o)<10?A.text(o+":0"+a):A.text(o+":"+a),P.val(yt()),P.attr("max",pt())}W===rt.size&&(q=!1,T.text("Finished Playing: "+rt.fileName))},1)})})();